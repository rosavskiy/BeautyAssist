# üîÑ –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å –ø—Ä–æ—à–ª–æ–π –≤–µ—Ä—Å–∏–∏

## ‚ö†Ô∏è –í–∞–∂–Ω–æ: –ò–∑–±–µ–∂–∞–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤

–ï—Å–ª–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —É–∂–µ –ª–µ–∂–∏—Ç **–ø—Ä–æ—à–ª–∞—è –≤–µ—Ä—Å–∏—è** –ø—Ä–æ–µ–∫—Ç–∞, –Ω—É–∂–Ω–æ –¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å –∞–∫–∫—É—Ä–∞—Ç–Ω–æ, —á—Ç–æ–±—ã –Ω–µ –ø–æ—Ç–µ—Ä—è—Ç—å –¥–∞–Ω–Ω—ã–µ –∏ –Ω–µ —Å–ª–æ–º–∞—Ç—å —Ä–∞–±–æ—Ç—É.

---

## üìä –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å (—Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–π)

### üÜï –ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (27,844+ —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞)
```
bot/
‚îú‚îÄ‚îÄ handlers/           # ‚≠ê –ù–û–í–û–ï - –º–æ–¥—É–ª—å–Ω—ã–µ handlers
‚îú‚îÄ‚îÄ middlewares/        # ‚≠ê –ù–û–í–û–ï - middleware stack
‚îú‚îÄ‚îÄ logging_config.py   # ‚≠ê –ù–û–í–û–ï - –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

database/
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îú‚îÄ‚îÄ subscription.py      # ‚≠ê –ù–û–í–û–ï
‚îÇ   ‚îú‚îÄ‚îÄ transaction.py       # ‚≠ê –ù–û–í–û–ï
‚îÇ   ‚îú‚îÄ‚îÄ promo_code.py       # ‚≠ê –ù–û–í–û–ï
‚îÇ   ‚îú‚îÄ‚îÄ referral.py         # ‚≠ê –ù–û–í–û–ï
‚îÇ   ‚îî‚îÄ‚îÄ admin_broadcast.py  # ‚≠ê –ù–û–í–û–ï
‚îî‚îÄ‚îÄ repositories/
    ‚îú‚îÄ‚îÄ subscription.py      # ‚≠ê –ù–û–í–û–ï
    ‚îú‚îÄ‚îÄ promo_code.py       # ‚≠ê –ù–û–í–û–ï
    ‚îú‚îÄ‚îÄ referral.py         # ‚≠ê –ù–û–í–û–ï
    ‚îî‚îÄ‚îÄ admin.py            # ‚≠ê –ù–û–í–û–ï

services/
‚îú‚îÄ‚îÄ payment.py              # ‚≠ê –ù–û–í–û–ï
‚îú‚îÄ‚îÄ analytics.py            # ‚≠ê –ù–û–í–û–ï
‚îú‚îÄ‚îÄ referral.py             # ‚≠ê –ù–û–í–û–ï
‚îú‚îÄ‚îÄ subscription_monitor.py # ‚≠ê –ù–û–í–û–ï
‚îî‚îÄ‚îÄ broadcast.py            # ‚≠ê –ù–û–í–û–ï

webapp/
‚îú‚îÄ‚îÄ admin/                  # ‚≠ê –ù–û–í–û–ï - –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å
‚îÇ   ‚îú‚îÄ‚îÄ analytics.html
‚îÇ   ‚îú‚îÄ‚îÄ analytics.js
‚îÇ   ‚îî‚îÄ‚îÄ analytics.css
‚îî‚îÄ‚îÄ master/                 # ‚≠ê –ù–û–í–û–ï - –º–∞—Å—Ç–µ—Ä WebApp
    ‚îú‚îÄ‚îÄ services.html
    ‚îú‚îÄ‚îÄ services.js
    ‚îî‚îÄ‚îÄ services.css

alembic/versions/           # ‚≠ê 5 –ù–û–í–´–• –º–∏–≥—Ä–∞—Ü–∏–π
tests/                      # ‚≠ê 15+ –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤
```

### üîÑ –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã (–º–æ–≥—É—Ç –±—ã—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã!)
- `bot/main.py` - **–°–ò–õ–¨–ù–û –∏–∑–º–µ–Ω—ë–Ω** (—É–ø—Ä–æ—â—ë–Ω —Å 2549 –¥–æ ~200 —Å—Ç—Ä–æ–∫)
- `bot/config.py` - –¥–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- `database/base.py` - –æ–±–Ω–æ–≤–ª—ë–Ω
- `requirements.txt` - –¥–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

---

## üõ°Ô∏è –°—Ç—Ä–∞—Ç–µ–≥–∏—è 1: –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

### –®–∞–≥ 1: –°–¥–µ–ª–∞–π—Ç–µ –±—ç–∫–∞–ø

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É
ssh your_user@your_server

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –±–æ—Ç–∞
sudo systemctl stop beautyassist  # –∏–ª–∏ pm2 stop beautyassist

# –°–¥–µ–ª–∞–π—Ç–µ –±—ç–∫–∞–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
sudo -u postgres pg_dump beautyassist > ~/backup_beautyassist_$(date +%Y%m%d_%H%M%S).sql

# –°–¥–µ–ª–∞–π—Ç–µ –±—ç–∫–∞–ø —Ç–µ–∫—É—â–µ–≥–æ –∫–æ–¥–∞
cd /var/www
sudo tar -czf BeautyAssist_backup_$(date +%Y%m%d_%H%M%S).tar.gz BeautyAssist/

# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ .env —Ñ–∞–π–ª –æ—Ç–¥–µ–ª—å–Ω–æ
cp BeautyAssist/.env ~/backup_env_$(date +%Y%m%d_%H%M%S)
```

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–µ–∫—É—â—É—é –≤–µ—Ä—Å–∏—é

```bash
cd /var/www/BeautyAssist
git status
git log --oneline -5
```

–ï—Å–ª–∏ –µ—Å—Ç—å –Ω–µ–∑–∞–∫–æ–º–º–∏—á–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:
```bash
# –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∏—Ö –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é –≤–µ—Ç–∫—É
git stash
git stash branch backup/local-changes
```

### –®–∞–≥ 3: –û–±–Ω–æ–≤–∏—Ç–µ –∫–æ–¥

```bash
# –ü–æ–ª—É—á–∏—Ç–µ –Ω–æ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
git fetch origin

# –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ, —á—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å
git log HEAD..origin/main --oneline

# –ï—Å–ª–∏ –≤—Å—ë –æ–∫ - –æ–±–Ω–æ–≤–ª—è–π—Ç–µ—Å—å
git pull origin main
```

**–ï—Å–ª–∏ –ø–æ—è–≤—è—Ç—Å—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã:**

```bash
# Git –ø–æ–∫–∞–∂–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏–µ —Ñ–∞–π–ª—ã
git status

# –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏—é:

# –í–∞—Ä–∏–∞–Ω—Ç A: –û—Å—Ç–∞–≤–∏—Ç—å –Ω–∞—à—É –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
git checkout --theirs path/to/file

# –í–∞—Ä–∏–∞–Ω—Ç B: –û—Å—Ç–∞–≤–∏—Ç—å —Å—Ç–∞—Ä—É—é –≤–µ—Ä—Å–∏—é (–µ—Å–ª–∏ —Ç–∞–º –≤–∞–∂–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è)
git checkout --ours path/to/file

# –í–∞—Ä–∏–∞–Ω—Ç C: –†–µ—à–∏—Ç—å –≤—Ä—É—á–Ω—É—é
nano path/to/file  # –ù–∞–π–¥–∏—Ç–µ <<<<<<, ======, >>>>>>

# –ü–æ—Å–ª–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
git add .
git commit -m "Resolved merge conflicts"
```

### –®–∞–≥ 4: –û–±–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
source venv/bin/activate
pip install -r requirements.txt --upgrade
```

**–ù–æ–≤—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
- `redis` - –¥–ª—è rate limiting
- `phonenumbers` - –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤
- `pydantic` - –≤–∞–ª–∏–¥–∞—Ü–∏—è API
- `apscheduler` - –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á

### –®–∞–≥ 5: –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–µ–∫—É—â—É—é –≤–µ—Ä—Å–∏—é
alembic current

# –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ, –∫–∞–∫–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –±—É–¥—É—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω—ã
alembic history

# –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –Ω–æ–≤—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏
alembic upgrade head
```

**5 –Ω–æ–≤—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π –¥–æ–±–∞–≤—è—Ç:**
- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –¢–∞–±–ª–∏—Ü—É `subscriptions`
- –¢–∞–±–ª–∏—Ü—É `transactions`
- –¢–∞–±–ª–∏—Ü—É `promo_codes` –∏ `promo_code_usages`
- –¢–∞–±–ª–∏—Ü—É `referrals`
- –¢–∞–±–ª–∏—Ü—É `admin_broadcasts`

### –®–∞–≥ 6: –û–±–Ω–æ–≤–∏—Ç–µ .env —Ñ–∞–π–ª

```bash
nano .env
```

**–î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:**
```env
# Redis (–¥–ª—è rate limiting)
REDIS_URL=redis://localhost:6379/0

# Admin IDs (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)
ADMIN_TELEGRAM_IDS=123456789,987654321

# YooKassa (–µ—Å–ª–∏ –±—É–¥–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å)
YOOKASSA_SHOP_ID=
YOOKASSA_SECRET_KEY=

# Logging
LOG_LEVEL=INFO

# Environment
ENVIRONMENT=production
```

### –®–∞–≥ 7: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—Å—ë –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è
python -c "from bot.main import main; print('OK')"

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–æ—Å—Ç—É–ø–Ω–∞
python -c "from database import init_db; import asyncio; asyncio.run(init_db()); print('DB OK')"
```

### –®–∞–≥ 8: –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞

```bash
sudo systemctl start beautyassist
sudo systemctl status beautyassist

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
sudo journalctl -u beautyassist -f
```

### –®–∞–≥ 9: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É

```bash
# Health check
curl http://localhost:8080/health

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á–µ—Ä–µ–∑ Telegram
# 1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ /start –±–æ—Ç—É
# 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ WebApp –∫–Ω–æ–ø–∫–∏
# 3. –ï—Å–ª–∏ –≤—ã –∞–¥–º–∏–Ω - –æ—Ç–ø—Ä–∞–≤—å—Ç–µ /admin
```

---

## üöÄ –°—Ç—Ä–∞—Ç–µ–≥–∏—è 2: –ß–∏—Å—Ç–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä—è–¥–æ–º (–µ—Å–ª–∏ –º–Ω–æ–≥–æ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤)

–ï—Å–ª–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ, –º–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é —Ä—è–¥–æ–º:

### –®–∞–≥ 1: –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ –≤ –Ω–æ–≤—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é

```bash
cd /var/www
sudo git clone https://github.com/rosavskiy/BeautyAssist.git BeautyAssist_new
cd BeautyAssist_new
```

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ

```bash
python3.11 -m venv venv
source venv/bin/activate
pip install -r requirements.txt

# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ .env –∏–∑ —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏
cp ../BeautyAssist/.env .env

# –î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (—Å–º. –≤—ã—à–µ)
nano .env
```

### –®–∞–≥ 3: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

```bash
# –ü—Ä–æ—Å—Ç–æ –ø—Ä–∏–º–µ–Ω–∏—Ç–µ –Ω–æ–≤—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏
alembic upgrade head
```

### –®–∞–≥ 4: –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ systemd –Ω–∞ –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é

```bash
sudo systemctl stop beautyassist

# –û–±–Ω–æ–≤–∏—Ç–µ –ø—É—Ç—å –≤ —Å–µ—Ä–≤–∏—Å–µ
sudo nano /etc/systemd/system/beautyassist.service
```

–ó–∞–º–µ–Ω–∏—Ç–µ:
```ini
WorkingDirectory=/var/www/BeautyAssist
```

–ù–∞:
```ini
WorkingDirectory=/var/www/BeautyAssist_new
```

```bash
sudo systemctl daemon-reload
sudo systemctl start beautyassist
```

### –®–∞–≥ 5: –ï—Å–ª–∏ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç - —É–¥–∞–ª–∏—Ç–µ —Å—Ç–∞—Ä—É—é –≤–µ—Ä—Å–∏—é

```bash
# –ß–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π, –∫–æ–≥–¥–∞ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å—ë –æ–∫
sudo rm -rf /var/www/BeautyAssist

# –ü–µ—Ä–µ–∏–º–µ–Ω—É–π—Ç–µ –Ω–æ–≤—É—é
sudo mv /var/www/BeautyAssist_new /var/www/BeautyAssist

# –û–±–Ω–æ–≤–∏—Ç–µ systemd –æ–±—Ä–∞—Ç–Ω–æ
sudo nano /etc/systemd/system/beautyassist.service
# WorkingDirectory=/var/www/BeautyAssist

sudo systemctl daemon-reload
sudo systemctl restart beautyassist
```

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –ü–ï–†–ï–î –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º

–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```bash
cd /var/www/BeautyAssist

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –µ—Å—Ç—å –ª–∏ –Ω–µ–∑–∞–∫–æ–º–º–∏—á–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
git status

# –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ, —á—Ç–æ –∏–∑–º–µ–Ω–∏—Ç—Å—è
git fetch origin
git diff HEAD..origin/main --stat

# –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ bot/main.py
git diff HEAD..origin/main -- bot/main.py | head -100

# –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Å–ø–∏—Å–æ–∫ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏—Ö —Ñ–∞–π–ª–æ–≤ (–µ—Å–ª–∏ –±—É–¥—É—Ç)
git merge-tree $(git merge-base HEAD origin/main) HEAD origin/main
```

---

## ‚ö†Ô∏è –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞ 1: "ImportError: cannot import name..."

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

**–†–µ—à–µ–Ω–∏–µ:**
```bash
pip install -r requirements.txt --upgrade
pip install redis phonenumbers pydantic apscheduler
```

### –ü—Ä–æ–±–ª–µ–º–∞ 2: "ModuleNotFoundError: No module named 'bot.handlers'"

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ –≤—Å–µ —Ñ–∞–π–ª—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞–ª–∏—Å—å

**–†–µ—à–µ–Ω–∏–µ:**
```bash
git status
git pull origin main --force
```

### –ü—Ä–æ–±–ª–µ–º–∞ 3: "alembic.util.exc.CommandError: Can't locate revision..."

**–ü—Ä–∏—á–∏–Ω–∞:** –ö–æ–Ω—Ñ–ª–∏–∫—Ç –≤ –∏—Å—Ç–æ—Ä–∏–∏ –º–∏–≥—Ä–∞—Ü–∏–π

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Ç–µ–∫—É—â—É—é –≤–µ—Ä—Å–∏—é
alembic current

# –ï—Å–ª–∏ –≤–µ—Ä—Å–∏—è –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –ø–æ—Å–ª–µ–¥–Ω–µ–π –º–∏–≥—Ä–∞—Ü–∏–µ–π
alembic stamp head  # –û–°–¢–û–†–û–ñ–ù–û! –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ —É–≤–µ—Ä–µ–Ω—ã!

# –ò–ª–∏ –æ—Ç–∫–∞—Ç–∏—Ç–µ—Å—å –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç–µ –∑–∞–Ω–æ–≤–æ
alembic downgrade -1
alembic upgrade head
```

### –ü—Ä–æ–±–ª–µ–º–∞ 4: "relation 'subscriptions' does not exist"

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –º–∏–≥—Ä–∞—Ü–∏–∏

**–†–µ—à–µ–Ω–∏–µ:**
```bash
alembic upgrade head
```

### –ü—Ä–æ–±–ª–µ–º–∞ 5: Redis connection error

**–ü—Ä–∏—á–∏–Ω–∞:** Redis –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω/–Ω–µ –∑–∞–ø—É—â–µ–Ω

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Redis
sudo apt install redis-server -y

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ
sudo systemctl start redis-server
sudo systemctl enable redis-server

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ
redis-cli ping  # –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å PONG
```

---

## üìã –ß–µ–∫–ª–∏—Å—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

- [ ] ‚úÖ –°–¥–µ–ª–∞–Ω –±—ç–∫–∞–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- [ ] ‚úÖ –°–¥–µ–ª–∞–Ω –±—ç–∫–∞–ø –∫–æ–¥–∞
- [ ] ‚úÖ –°–æ—Ö—Ä–∞–Ω—ë–Ω .env —Ñ–∞–π–ª
- [ ] ‚úÖ –ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- [ ] ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã
- [ ] ‚úÖ –ö–æ–¥ –æ–±–Ω–æ–≤–ª—ë–Ω (git pull)
- [ ] ‚úÖ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã (pip install)
- [ ] ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã (alembic upgrade head)
- [ ] ‚úÖ .env –æ–±–Ω–æ–≤–ª—ë–Ω (–Ω–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ)
- [ ] ‚úÖ Redis —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –∑–∞–ø—É—â–µ–Ω
- [ ] ‚úÖ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω
- [ ] ‚úÖ Health check –ø—Ä–æ—Ö–æ–¥–∏—Ç
- [ ] ‚úÖ –û—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] ‚úÖ WebApp –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è
- [ ] ‚úÖ Admin –ø–∞–Ω–µ–ª—å –¥–æ—Å—Ç—É–ø–Ω–∞ (–¥–ª—è –∞–¥–º–∏–Ω–æ–≤)

---

## üÜò –ü–ª–∞–Ω –æ—Ç–∫–∞—Ç–∞ (–µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫)

```bash
# 1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –±–æ—Ç–∞
sudo systemctl stop beautyassist

# 2. –û—Ç–∫–∞—Ç–∏—Ç–µ –∫–æ–¥
cd /var/www/BeautyAssist
git reset --hard HEAD~1  # –û—Ç–∫–∞—Ç –Ω–∞ 1 –∫–æ–º–º–∏—Ç –Ω–∞–∑–∞–¥

# 3. –û—Ç–∫–∞—Ç–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏
alembic downgrade -5  # –û—Ç–∫–∞—Ç 5 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –º–∏–≥—Ä–∞—Ü–∏–π

# 4. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ .env (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
cp ~/backup_env_XXXXXXXX .env

# 5. –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt

# 6. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞
sudo systemctl start beautyassist

# 7. –ï—Å–ª–∏ –≤—Å—ë —Å–æ–≤—Å–µ–º –ø–ª–æ—Ö–æ - –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∏–∑ –±—ç–∫–∞–ø–∞
cd /var/www
sudo tar -xzf BeautyAssist_backup_XXXXXXXX.tar.gz
```

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞:
1. **–û–±–Ω–æ–≤–ª—è–π—Ç–µ—Å—å –≤ –Ω–µ—Ä–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è** (–Ω–æ—á—å—é, –∫–æ–≥–¥–∞ –º–∞–ª–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –°—Ç—Ä–∞—Ç–µ–≥–∏—é 2** (—á–∏—Å—Ç–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä—è–¥–æ–º) –¥–ª—è –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏–∏ —Ä–∏—Å–∫–æ–≤
3. **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –Ω–∞ staging** –ø–µ—Ä–µ–¥ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–æ–º (–µ—Å–ª–∏ –µ—Å—Ç—å)
4. **–ò–º–µ–π—Ç–µ –ø–æ–¥ —Ä—É–∫–æ–π –±—ç–∫–∞–ø** –∏ –ø–ª–∞–Ω –æ—Ç–∫–∞—Ç–∞
5. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –ª–æ–≥–∏** –ø–µ—Ä–≤—ã–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —á–∞—Å–æ–≤ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏/—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
1. –ú–æ–∂–Ω–æ —Å–º–µ–ª–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **–°—Ç—Ä–∞—Ç–µ–≥–∏—é 1** (–ø—Ä—è–º–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ)
2. –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ —Å–ª–æ–º–∞–ª–æ—Å—å - –ª–µ–≥–∫–æ –æ—Ç–∫–∞—Ç–∏—Ç—å—Å—è –∏–ª–∏ –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `sudo journalctl -u beautyassist -f`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—à–∏–±–∫–∏: `tail -f logs/errors.log`
3. –û—Ç–∫—Ä–æ–π—Ç–µ Issue –Ω–∞ GitHub: https://github.com/rosavskiy/BeautyAssist/issues

---

**–£–¥–∞—á–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è! üöÄ**
