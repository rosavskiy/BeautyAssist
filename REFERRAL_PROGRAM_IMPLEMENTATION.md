# üéÅ –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ - –ü–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

**–î–∞—Ç–∞:** 5 –¥–µ–∫–∞–±—Ä—è 2025  
**Sprint:** 7 - –ë–ª–æ–∫ 1  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ

## üìã –û–±–∑–æ—Ä

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ –¥–ª—è BeautyAssist. –ú–∞—Å—Ç–µ—Ä–∞ –º–æ–≥—É—Ç –ø—Ä–∏–≥–ª–∞—à–∞—Ç—å –¥—Ä—É–≥–∏—Ö –º–∞—Å—Ç–µ—Ä–æ–≤ –∏ –ø–æ–ª—É—á–∞—Ç—å **+7 –¥–Ω–µ–π –ø–æ–¥–ø–∏—Å–∫–∏** –∑–∞ –∫–∞–∂–¥–æ–≥–æ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ä–µ—Ñ–µ—Ä–∞–ª–∞.

## üéØ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

### 1. Backend –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

#### –ú–æ–¥–µ–ª—å `Referral` (database/models/referral.py)
```python
class Referral(Base):
    id: int (PK)
    referrer_id: int (FK ‚Üí masters.id)     # –ö—Ç–æ –ø—Ä–∏–≥–ª–∞—Å–∏–ª
    referred_id: int (FK ‚Üí masters.id)     # –ö–æ–≥–æ –ø—Ä–∏–≥–ª–∞—Å–∏–ª–∏
    status: ReferralStatus                 # pending/activated/expired
    reward_given: bool
    reward_days: int (default=7)
    created_at: datetime
    activated_at: datetime | None
```

**–°—Ç–∞—Ç—É—Å—ã:**
- `pending` - —Ä–µ—Ñ–µ—Ä–∞–ª –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω, –Ω–æ –Ω–µ –æ–ø–ª–∞—Ç–∏–ª –ø–æ–¥–ø–∏—Å–∫—É
- `activated` - —Ä–µ—Ñ–µ—Ä–∞–ª –æ–ø–ª–∞—Ç–∏–ª ‚Üí –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–µ –Ω–∞—á–∏—Å–ª–µ–Ω–æ
- `expired` - —Ä–µ—Ñ–µ—Ä–∞–ª –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–ª—Å—è –∑–∞ 30 –¥–Ω–µ–π

#### ReferralRepository (database/repositories/referral.py)
**–ú–µ—Ç–æ–¥—ã:**
- `create()` - —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –æ —Ä–µ—Ñ–µ—Ä–∞–ª–µ
- `get_by_referred_id()` - –ø–æ–∏—Å–∫ –ø–æ ID –ø—Ä–∏–≥–ª–∞—à—ë–Ω–Ω–æ–≥–æ
- `get_all_by_referrer()` - –≤—Å–µ —Ä–µ—Ñ–µ—Ä–∞–ª—ã –º–∞—Å—Ç–µ—Ä–∞
- `activate()` - –∞–∫—Ç–∏–≤–∞—Ü–∏—è —Ä–µ—Ñ–µ—Ä–∞–ª–∞
- `expire_old_referrals()` - –∏—Å—Ç–µ–∫–∞–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ (30+ –¥–Ω–µ–π)
- `get_statistics()` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (pending/activated/expired/total_reward_days)
- `check_duplicate()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

#### ReferralService (services/referral.py)
**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- `generate_referral_link()` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Å—ã–ª–∫–∏ `t.me/YourBot?start=ref_XXXXXX`
- `decode_referral_code()` - –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ base64 –∫–æ–¥–∞
- `create_referral()` - —Å–æ–∑–¥–∞–Ω–∏–µ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π (self-referral, duplicates)
- `activate_referral()` - –∞–∫—Ç–∏–≤–∞—Ü–∏—è + –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –¥–Ω–µ–π + —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
- `get_statistics()` - –∞–≥–≥—Ä–µ–≥–∞—Ü–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- `expire_old_referrals()` - —Ñ–æ–Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞ –¥–ª—è –∏—Å—Ç–µ–∫–∞–Ω–∏—è

### 2. Frontend - Telegram Bot

#### –ö–æ–º–∞–Ω–¥–∞ `/referral`
**UI:**
```
üéÅ –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞

–ü—Ä–∏–≥–ª–∞—à–∞–π –¥—Ä—É–≥–∏—Ö –º–∞—Å—Ç–µ—Ä–æ–≤ –∏ –ø–æ–ª—É—á–∞–π +7 –¥–Ω–µ–π –ø–æ–¥–ø–∏—Å–∫–∏ –∑–∞ –∫–∞–∂–¥–æ–≥–æ!

üìä –¢–≤–æ—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
–í—Å–µ–≥–æ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤: 3
‚îú‚îÄ –ê–∫—Ç–∏–≤–Ω—ã–µ: 2 ‚úÖ
‚îú‚îÄ –û–∂–∏–¥–∞—é—Ç –∞–∫—Ç–∏–≤–∞—Ü–∏–∏: 1 ‚è≥
‚îî‚îÄ –ò—Å—Ç—ë–∫—à–∏–µ: 0 ‚ùå

üéâ –ü–æ–ª—É—á–µ–Ω–æ –¥–Ω–µ–π: 14

üîó –¢–≤–æ—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞:
https://t.me/YourBot?start=ref_XXXXXX

[üì§ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Å—Å—ã–ª–∫–æ–π]
[üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É]
```

**–ö–Ω–æ–ø–∫–∏:**
- "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Å—Å—ã–ª–∫–æ–π" - `switch_inline_query` —Å –≥–æ—Ç–æ–≤—ã–º —Ç–µ–∫—Å—Ç–æ–º
- "–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É" - callback –¥–ª—è refresh

### 3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

#### Onboarding (bot/handlers/onboarding.py)
**–õ–æ–≥–∏–∫–∞ –ø—Ä–∏ `/start ref_XXXXXX`:**
1. –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å `referrer_id` –∏–∑ base64
2. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–≥–æ –º–∞—Å—Ç–µ—Ä–∞
3. –°–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å `Referral` (status=pending)
4. –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å trial 14 –¥–Ω–µ–π
5. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å onboarding

**–ó–∞—â–∏—Ç–∞:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è referrer
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ self-referral

#### Subscription (bot/handlers/subscription.py)
**–õ–æ–≥–∏–∫–∞ –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç–µ:**
```python
# –ü–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞—Ç–µ–∂–∞
referral_service = ReferralService(session)
result = await referral_service.activate_referral(
    referred_id=master.id,
    bot=bot
)

# –†–µ–∑—É–ª—å—Ç–∞—Ç:
# - –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ pending ‚Üí activated
# - –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ +7 –¥–Ω–µ–π —Ä–µ—Ñ–µ—Ä–µ—Ä—É
# - –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ä–µ—Ñ–µ—Ä–µ—Ä—É
```

**–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–µ—Ä—É:**
```
üéâ –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–µ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–µ!

–í–∞—à —Ä–µ—Ñ–µ—Ä–∞–ª –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–ª –ø–æ–¥–ø–∏—Å–∫—É!
–í–∞–º –Ω–∞—á–∏—Å–ª–µ–Ω–æ +7 –¥–Ω–µ–π –ø–æ–¥–ø–∏—Å–∫–∏.

–ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –ø—Ä–∏–≥–ª–∞—à–∞—Ç—å –¥—Ä—É–∑–µ–π! üöÄ
```

### 4. Database Migration

**Alembic migration:** `2025_12_05_0118-4c7e7d471023_add_referrals_tracking_table.py`

**–°–æ–∑–¥–∞—ë—Ç:**
- –¢–∞–±–ª–∏—Ü–∞ `referrals` —Å –ø–æ–ª—è–º–∏
- Foreign keys –Ω–∞ `masters.id`
- –ò–Ω–¥–µ–∫—Å—ã: `referrer_id`, `referred_id`, `status`

### 5. Unit Tests

**–§–∞–π–ª:** `tests/test_referrals.py` (8 —Ç–µ—Å—Ç–æ–≤)

**–ü–æ–∫—Ä—ã—Ç–∏–µ:**
- ‚úÖ `test_generate_referral_link` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Å—ã–ª–æ–∫
- ‚úÖ `test_create_referral` - —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏
- ‚úÖ `test_activate_referral` - –∞–∫—Ç–∏–≤–∞—Ü–∏—è —Å –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º —Å—Ç–∞—Ç—É—Å–∞
- ‚úÖ `test_get_statistics` - –ø–æ–¥—Å—á—ë—Ç pending/activated/expired
- ‚úÖ `test_expire_old_referrals` - –∏—Å—Ç–µ–∫–∞–Ω–∏–µ –ø–æ—Å–ª–µ 30 –¥–Ω–µ–π
- ‚úÖ `test_duplicate_referral` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
- ‚úÖ `test_referral_service_create` - —Å–µ—Ä–≤–∏—Å —Å–æ–∑–¥–∞–Ω–∏—è
- ‚úÖ `test_self_referral_prevention` - –∑–∞—â–∏—Ç–∞ –æ—Ç self-referral

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 8/8 passed ‚úÖ

## üìä –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ö–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö —Å—Å—ã–ª–æ–∫
```python
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è
encoded = base64.urlsafe_b64encode(str(master_id).encode()).decode().rstrip('=')
link = f"https://t.me/{BOT_USERNAME}?start=ref_{encoded}"

# –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ
code = code[4:]  # –£–¥–∞–ª–∏—Ç—å 'ref_'
padding = 4 - len(code) % 4
if padding != 4:
    code += '=' * padding
decoded = base64.urlsafe_b64decode(code).decode()
master_id = int(decoded)
```

### –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è
```python
# –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏
subscription = await subscription_repo.get_active_subscription(referrer_id)
if subscription:
    new_expires = subscription.expires_at + timedelta(days=reward_days)
    await subscription_repo.extend_subscription(subscription.id, new_expires)
```

### –ò—Å—Ç–µ–∫–∞–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤
**–õ–æ–≥–∏–∫–∞:**
- Pending —Ä–µ—Ñ–µ—Ä–∞–ª—ã —Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π ‚Üí status=expired
- –ú–æ–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ APScheduler
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –î–ª—è –º–∞—Å—Ç–µ—Ä–∞

**1. –ü–æ–ª—É—á–∏—Ç—å —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É:**
```
/referral
‚Üí –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É –∏–ª–∏ –Ω–∞–∂–∞—Ç—å "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è"
```

**2. –ü–æ–¥–µ–ª–∏—Ç—å—Å—è:**
- –ß–µ—Ä–µ–∑ inline query –≤ –ª—é–±–æ–º —á–∞—Ç–µ
- –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ —Å–æ—Ü—Å–µ—Ç—è—Ö
- –í WhatsApp, Instagram Direct, –í–ö–æ–Ω—Ç–∞–∫—Ç–µ

**3. –û—Ç—Å–ª–µ–¥–∏—Ç—å —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤:**
```
/referral
‚Üí –£–≤–∏–¥–µ—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É (pending/activated/expired)
‚Üí –û–±–Ω–æ–≤–∏—Ç—å —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É
```

### –î–ª—è —Ä–µ—Ñ–µ—Ä–∞–ª–∞

**1. –ü–µ—Ä–µ–π—Ç–∏ –ø–æ —Å—Å—ã–ª–∫–µ:**
```
https://t.me/YourBot?start=ref_XXXXXX
```

**2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:**
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–∞–∫ –Ω–æ–≤—ã–π –º–∞—Å—Ç–µ—Ä
- –°–æ–∑–¥–∞–Ω–∏–µ —Å–≤—è–∑–∏ —Å —Ä–µ—Ñ–µ—Ä–æ–º
- –ê–∫—Ç–∏–≤–∞—Ü–∏—è trial 14 –¥–Ω–µ–π
- –ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ onboarding

**3. –ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –ø–µ—Ä–≤–æ–π –ø–æ–¥–ø–∏—Å–∫–∏:**
- –°—Ç–∞—Ç—É—Å –º–µ–Ω—è–µ—Ç—Å—è pending ‚Üí activated
- –†–µ—Ñ–µ—Ä–µ—Ä—É –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è +7 –¥–Ω–µ–π
- –†–µ—Ñ–µ—Ä–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### –î–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
```python
stats = await referral_service.get_statistics(master_id)
# {
#     'total': 5,
#     'pending': 2,
#     'activated': 3,
#     'expired': 0,
#     'total_reward_days': 21
# }
```

### –î–ª—è –∞–¥–º–∏–Ω–∞ (–±—É–¥—É—â–µ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ)
- –¢–æ–ø —Ä–µ—Ñ–µ—Ä–µ—Ä–æ–≤ (–ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö)
- –ö–æ–Ω–≤–µ—Ä—Å–∏—è pending ‚Üí activated
- –°—Ä–µ–¥–Ω–∏–π —Å—Ä–æ–∫ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ —Ä–µ—Ñ–µ—Ä–∞–ª–∞
- Total –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è –ø–æ –≤—Å–µ–º –º–∞—Å—Ç–µ—Ä–∞–º

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

**–ü—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ä–µ—Ñ–µ—Ä–∞–ª–∞:**
1. –†–µ—Ñ–µ—Ä —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –ë–î
2. –†–µ—Ñ–µ—Ä–∞–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –ë–î
3. –ù–µ self-referral (referrer_id ‚â† referred_id)
4. –ù–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç–∞ (—É–Ω–∏–∫–∞–ª—å–Ω–∞—è –ø–∞—Ä–∞ referrer_id + referred_id)

**–ü—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏:**
1. –†–µ—Ñ–µ—Ä–∞–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
2. –°—Ç–∞—Ç—É—Å pending (–Ω–µ activated/expired)
3. –ü–µ—Ä–≤–∞—è –æ–ø–ª–∞—Ç–∞ (–Ω–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ)

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ `services/referral.py`:**
```python
REWARD_DAYS = 7          # –î–Ω–µ–π –∑–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏—é
EXPIRATION_DAYS = 30     # –î–Ω–µ–π –¥–æ –∏—Å—Ç–µ–∫–∞–Ω–∏—è pending
```

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤ `bot/config.py`:**
```python
BOT_USERNAME = settings.bot_username  # –î–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å—Å—ã–ª–æ–∫
```

## üêõ –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **–¢–æ–ª—å–∫–æ –ø–µ—Ä–≤–∞—è –æ–ø–ª–∞—Ç–∞:**  
   –í–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–µ –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –∞–∫—Ç–∏–≤–∞—Ü–∏–∏. –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø—Ä–æ–¥–ª–µ–Ω–∏—è –Ω–µ –¥–∞—é—Ç –±–æ–Ω—É—Å—ã.

2. **–ù–µ—Ç retroactive rewards:**  
   –ï—Å–ª–∏ —Ä–µ—Ñ–µ—Ä–∞–ª –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª—Å—è –¥–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã, —Å–≤—è–∑—å –Ω–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è.

3. **Trial –Ω–µ –Ω–∞—á–∏—Å–ª—è–µ—Ç:**  
   –ê–∫—Ç–∏–≤–∞—Ü–∏—è trial –Ω–µ –Ω–∞—á–∏—Å–ª—è–µ—Ç –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–µ—Ä—É (—Ç–æ–ª—å–∫–æ –ø–ª–∞—Ç–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞).

4. **–ù–µ—Ç multi-level:**  
   –¢–æ–ª—å–∫–æ 1 —É—Ä–æ–≤–µ–Ω—å - direct referral. –ù–µ—Ç MLM —Å—Ç—Ä—É–∫—Ç—É—Ä—ã.

## üîÆ –ü–ª–∞–Ω—ã —Ä–∞–∑–≤–∏—Ç–∏—è

### Phase 2 (Sprint 8):
- [ ] –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å: —Ç–æ–ø —Ä–µ—Ñ–µ—Ä–µ—Ä–æ–≤
- [ ] –≠–∫—Å–ø–æ—Ä—Ç —Å–ø–∏—Å–∫–∞ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ –≤ CSV
- [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Ä–µ—Ñ–µ—Ä–∞–ª–∞
- [ ] –ë–æ–Ω—É—Å –∑–∞ N –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ (milestone rewards)

### Phase 3 (Sprint 9):
- [ ] –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ –ø—Ä–æ–º–æ–∫–æ–¥—ã (–≤–º–µ—Å—Ç–æ —Å—Å—ã–ª–æ–∫)
- [ ] –ö–∞—Å—Ç–æ–º–Ω—ã–µ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è (–ø—Ä–æ—Ü–µ–Ω—Ç –æ—Ç –æ–ø–ª–∞—Ç—ã —Ä–µ—Ñ–µ—Ä–∞–ª–∞)
- [ ] Lifetime rewards (–ø—Ä–æ—Ü–µ–Ω—Ç –æ—Ç –≤—Å–µ—Ö –ø–ª–∞—Ç–µ–∂–µ–π —Ä–µ—Ñ–µ—Ä–∞–ª–∞)
- [ ] Leaderboard —Å —Ç–æ–ø-10 —Ä–µ—Ñ–µ—Ä–µ—Ä–æ–≤

### Phase 4:
- [ ] Multi-level referrals (2 —É—Ä–æ–≤–Ω—è)
- [ ] –ü–∞—Ä—Ç–Ω—ë—Ä—Å–∫–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ —Å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –≤—ã–ø–ª–∞—Ç–∞–º–∏
- [ ] API –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö –ø–∞—Ä—Ç–Ω—ë—Ä–æ–≤

## üìù Changelog

**2025-12-05 (Sprint 7.1):**
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –º–æ–¥–µ–ª—å `Referral` –∏ –º–∏–≥—Ä–∞—Ü–∏—è –ë–î
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω `ReferralRepository` (CRUD + —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞)
- ‚úÖ –°–æ–∑–¥–∞–Ω `ReferralService` (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Å—ã–ª–æ–∫, –∞–∫—Ç–∏–≤–∞—Ü–∏—è)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω handler `/referral` —Å UI
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤ onboarding
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –≤ subscription
- ‚úÖ –ù–∞–ø–∏—Å–∞–Ω—ã 8 unit-—Ç–µ—Å—Ç–æ–≤ (100% pass rate)
- ‚úÖ –ë–æ—Ç –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω –ª–æ–∫–∞–ª—å–Ω–æ

## üéâ –ò—Ç–æ–≥

–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é! –ú–∞—Å—Ç–µ—Ä–∞ –º–æ–≥—É—Ç:
- –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ —Å—Å—ã–ª–∫–∏
- –î–µ–ª–∏—Ç—å—Å—è —á–µ—Ä–µ–∑ inline query
- –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤
- –ü–æ–ª—É—á–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è (+7 –¥–Ω–µ–π)

**–°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç end-to-end:**  
–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è ‚Üí –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ ‚Üí –û–ø–ª–∞—Ç–∞ ‚Üí –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ ‚Üí –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ ‚úÖ
