# ‚úÖ –¢–µ—Å—Ç-–ø–ª–∞–Ω: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è Day 2

**–î–∞—Ç–∞:** 6 –¥–µ–∫–∞–±—Ä—è 2025  
**–ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ–º:** –î–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º—É –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π

---

## üîß –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è

### 1. –î–µ–ø–ª–æ–π –≤—ã–ø–æ–ª–Ω–µ–Ω (—Å–º. DEPLOY_DAY2.md)
```bash
ssh root@v2992624.hosted-by-vdsina.ru
cd /var/www/BeautyAssist
git pull origin main
sudo systemctl restart beautyassist-bot
sudo systemctl status beautyassist-bot  # –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å active (running)
```

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –±–æ—Ç–∞
```bash
# –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –±–æ—Ç –∑–∞–ø—É—Å—Ç–∏–ª—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
tail -50 /var/www/BeautyAssist/logs/bot.log

# –ò—Å–∫–∞—Ç—å —Å—Ç—Ä–æ–∫–∏:
# "Database initialized"
# "Handlers registered"
# "Reminder scheduler started"
# "Starting bot polling..."
```

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ scheduler —Ä–∞–±–æ—Ç–∞–µ—Ç
```bash
# –í –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å—Ç—Ä–æ–∫–∏ –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É:
grep "Sent.*reminders" /var/www/BeautyAssist/logs/bot.log | tail -10

# –ï—Å–ª–∏ –Ω–µ—Ç - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—à–∏–±–∫–∏:
grep "Error sending reminders" /var/www/BeautyAssist/logs/bot.log | tail -10
```

---

## üß™ –¢–µ—Å—Ç 1: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ –∑–∞–ø–∏—Å–∏ –º–∞—Å—Ç–µ—Ä–æ–º

### –®–∞–≥–∏:

**1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞: —Å–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –∑–∞–ø–∏—Å—å**
- –û—Ç–∫—Ä—ã—Ç—å –±–æ—Ç–∞ –∫–∞–∫ –∫–ª–∏–µ–Ω—Ç
- –ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —É—Å–ª—É–≥—É —á–µ—Ä–µ–∑ WebApp
- –ó–∞–ø–æ–º–Ω–∏—Ç—å –≤—Ä–µ–º—è –∑–∞–ø–∏—Å–∏

**2. –î–µ–π—Å—Ç–≤–∏–µ: –æ—Ç–º–µ–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å –æ—Ç –∏–º–µ–Ω–∏ –º–∞—Å—Ç–µ—Ä–∞**

**–í–∞—Ä–∏–∞–Ω—Ç A - –ß–µ—Ä–µ–∑ API (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):**
```bash
curl -X POST "https://v2992624.hosted-by-vdsina.ru/api/appointment/cancel/master" \
  -H "Content-Type: application/json" \
  -d '{
    "appointment_id": 123,
    "reason": "–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π"
  }'
```

**–í–∞—Ä–∏–∞–Ω—Ç B - –ß–µ—Ä–µ–∑ Mini App:**
- –û—Ç–∫—Ä—ã—Ç—å appointments.html –æ—Ç –∏–º–µ–Ω–∏ –º–∞—Å—Ç–µ—Ä–∞
- –ù–∞–π—Ç–∏ —Å–æ–∑–¥–∞–Ω–Ω—É—é –∑–∞–ø–∏—Å—å
- –ù–∞–∂–∞—Ç—å "–û—Ç–º–µ–Ω–∏—Ç—å"
- –í–≤–µ—Å—Ç–∏ –ø—Ä–∏—á–∏–Ω—É –æ—Ç–º–µ–Ω—ã

**3. –û–∂–∏–¥–∞–Ω–∏–µ: –ø–æ–¥–æ–∂–¥–∞—Ç—å 1-2 –º–∏–Ω—É—Ç—ã**
- Scheduler —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –ø—Ä–∏–π—Ç–∏ –≤ —Ç–µ—á–µ–Ω–∏–µ 60-90 —Å–µ–∫—É–Ω–¥

**4. –ü—Ä–æ–≤–µ—Ä–∫–∞: –∫–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∏–ª —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ**

**–û–∂–∏–¥–∞–µ–º—ã–π —Ç–µ–∫—Å—Ç:**
```
‚ùå –ú–∞—Å—Ç–µ—Ä –æ—Ç–º–µ–Ω–∏–ª –∑–∞–ø–∏—Å—å

üìã –£—Å–ª—É–≥–∞: [–Ω–∞–∑–≤–∞–Ω–∏–µ —É—Å–ª—É–≥–∏]
üìÖ –î–∞—Ç–∞: 7 –¥–µ–∫–∞–±—Ä—è 2025 –≤ 14:00 (Europe/Moscow)
üí¨ –ü—Ä–∏—á–∏–Ω–∞: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

–í—ã –º–æ–∂–µ—Ç–µ –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –¥—Ä—É–≥–æ–µ –≤—Ä–µ–º—è —á–µ—Ä–µ–∑ –±–æ—Ç–∞.
```

**5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ë–î:**
```sql
-- –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –ë–î
psql -U beautyassist -d beautyassist

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ reminder —Å–æ–∑–¥–∞–Ω –∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω
SELECT 
    id,
    appointment_id,
    reminder_type,
    scheduled_time,
    sent_at,
    status,
    extra_data
FROM reminders 
WHERE reminder_type = 'cancelled_by_master'
ORDER BY created_at DESC 
LIMIT 1;

-- –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
-- reminder_type = 'cancelled_by_master'
-- status = 'sent'
-- sent_at IS NOT NULL
-- extra_data —Å–æ–¥–µ—Ä–∂–∏—Ç {"reason": "–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π"}
```

**6. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ª–æ–≥–∞—Ö:**
```bash
grep "Created cancellation reminder" /var/www/BeautyAssist/logs/bot.log | tail -1
grep "Sent reminder: CANCELLED_BY_MASTER" /var/www/BeautyAssist/logs/bot.log | tail -1
```

---

## üß™ –¢–µ—Å—Ç 2: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø—Ä–∏ –ø–µ—Ä–µ–Ω–æ—Å–µ –∑–∞–ø–∏—Å–∏ –º–∞—Å—Ç–µ—Ä–æ–º

### –®–∞–≥–∏:

**1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞: —Å–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –∑–∞–ø–∏—Å—å**
- –û—Ç–∫—Ä—ã—Ç—å –±–æ—Ç–∞ –∫–∞–∫ –∫–ª–∏–µ–Ω—Ç
- –ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ 14:00

**2. –î–µ–π—Å—Ç–≤–∏–µ: –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –∑–∞–ø–∏—Å—å –æ—Ç –∏–º–µ–Ω–∏ –º–∞—Å—Ç–µ—Ä–∞**

**–ß–µ—Ä–µ–∑ API:**
```bash
curl -X POST "https://v2992624.hosted-by-vdsina.ru/api/appointment/reschedule/master" \
  -H "Content-Type: application/json" \
  -d '{
    "appointment_id": 124,
    "new_start_time": "2025-12-07T16:00:00"
  }'
```

**3. –û–∂–∏–¥–∞–Ω–∏–µ: –ø–æ–¥–æ–∂–¥–∞—Ç—å 1-2 –º–∏–Ω—É—Ç—ã**

**4. –ü—Ä–æ–≤–µ—Ä–∫–∞: –∫–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∏–ª —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ**

**–û–∂–∏–¥–∞–µ–º—ã–π —Ç–µ–∫—Å—Ç:**
```
üîÑ –ú–∞—Å—Ç–µ—Ä –ø–µ—Ä–µ–Ω–µ—Å –≤–∞—à—É –∑–∞–ø–∏—Å—å

üìã –£—Å–ª—É–≥–∞: [–Ω–∞–∑–≤–∞–Ω–∏–µ —É—Å–ª—É–≥–∏]
–ë—ã–ª–æ: 7 –¥–µ–∫–∞–±—Ä—è 2025 –≤ 14:00
–°—Ç–∞–ª–æ: 7 –¥–µ–∫–∞–±—Ä—è 2025 –≤ 16:00 (Europe/Moscow)

üë§ –ú–∞—Å—Ç–µ—Ä: [–∏–º—è –º–∞—Å—Ç–µ—Ä–∞]
```

**5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ë–î:**
```sql
SELECT 
    id,
    appointment_id,
    reminder_type,
    scheduled_time,
    sent_at,
    status,
    extra_data
FROM reminders 
WHERE reminder_type = 'rescheduled'
ORDER BY created_at DESC 
LIMIT 1;

-- –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
-- reminder_type = 'rescheduled'
-- status = 'sent'
-- extra_data —Å–æ–¥–µ—Ä–∂–∏—Ç {"old_time": "7 –¥–µ–∫–∞–±—Ä—è 2025 –≤ 14:00"}
```

---

## üß™ –¢–µ—Å—Ç 3: –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ü–µ–Ω –≤ appointments.html

**1. –û—Ç–∫—Ä—ã—Ç—å appointments.html –∫–∞–∫ –∫–ª–∏–µ–Ω—Ç:**
```
https://v2992624.hosted-by-vdsina.ru/webapp/appointments.html?tid=YOUR_TELEGRAM_ID
```

**2. –ù–∞–π—Ç–∏ –∑–∞–ø–∏—Å—å –≤ —Å–ø–∏—Å–∫–µ**

**3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Ü–µ–Ω–∞:**
```
[–ù–∞–∑–≤–∞–Ω–∏–µ —É—Å–ª—É–≥–∏]
üìÖ 7 –¥–µ–∫–∞–±—Ä—è 2025, 14:00
üí∞ 1000 ‚ÇΩ  ‚Üê –î–û–õ–ñ–ù–û –ë–´–¢–¨ –í–ò–î–ù–û
```

**4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ DevTools Console:**
- –û—Ç–∫—Ä—ã—Ç—å F12 ‚Üí Console
- –ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—à–∏–±–æ–∫ JavaScript
- API response –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å `service_price: 1000`

---

## üìä –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞

- [‚úÖ] –ö–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ –∑–∞–ø–∏—Å–∏ –º–∞—Å—Ç–µ—Ä–æ–º
- [‚úÖ] –ö–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø—Ä–∏ –ø–µ—Ä–µ–Ω–æ—Å–µ –∑–∞–ø–∏—Å–∏ –º–∞—Å—Ç–µ—Ä–æ–º
- [‚úÖ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç –≤ —Ç–µ—á–µ–Ω–∏–µ 1-2 –º–∏–Ω—É—Ç
- [‚úÖ] –¢–µ–∫—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω (—Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–∏—á–∏–Ω—É/—Å—Ç–∞—Ä–æ–µ –≤—Ä–µ–º—è)
- [‚úÖ] –¶–µ–Ω—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ appointments.html
- [‚úÖ] –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö –±–æ—Ç–∞
- [‚úÖ] Reminders –∏–º–µ—é—Ç status='sent' –≤ –ë–î

---

## üêõ Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –Ω–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç

**1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ reminder —Å–æ–∑–¥–∞–Ω:**
```sql
SELECT * FROM reminders 
WHERE appointment_id = 123 
ORDER BY created_at DESC;
```

**2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å scheduled_time:**
```sql
SELECT 
    scheduled_time,
    NOW() as current_time,
    (NOW() - scheduled_time) as delay
FROM reminders 
WHERE id = [reminder_id];

-- scheduled_time –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å <= NOW()
```

**3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ scheduler —Ä–∞–±–æ—Ç–∞–µ—Ç:**
```bash
# –í –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–ø–∏—Å–∏ –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
tail -f /var/www/BeautyAssist/logs/bot.log | grep "reminder"
```

**4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—à–∏–±–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏:**
```sql
SELECT 
    id,
    status,
    error_message
FROM reminders 
WHERE status = 'failed'
ORDER BY created_at DESC 
LIMIT 5;
```

### –ü—Ä–æ–±–ª–µ–º–∞: –¶–µ–Ω–∞ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è

**1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å API response:**
```bash
curl "https://v2992624.hosted-by-vdsina.ru/api/client/appointments?tid=YOUR_ID"
```

–î–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å:
```json
{
  "appointments": [
    {
      "service_name": "...",
      "service_price": 1000,  ‚Üê –î–û–õ–ñ–ù–û –ë–´–¢–¨
      ...
    }
  ]
}
```

**2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —É —É—Å–ª—É–≥–∏ –µ—Å—Ç—å —Ü–µ–Ω–∞:**
```sql
SELECT id, name, price FROM services WHERE id = [service_id];
```

**3. –û—á–∏—Å—Ç–∏—Ç—å –∫–µ—à –±—Ä–∞—É–∑–µ—Ä–∞:**
- Ctrl+Shift+R (hard reload)
- –ò–ª–∏ –æ—Ç–∫—Ä—ã—Ç—å –≤ incognito mode

---

## üìù –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

**–ó–∞–ø–æ–ª–Ω–∏—Ç—å –ø–æ—Å–ª–µ —Ç–µ—Å—Ç–æ–≤:**

### –¢–µ—Å—Ç 1: –û—Ç–º–µ–Ω–∞ –∑–∞–ø–∏—Å–∏
- [ ] ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–æ
- [ ] ‚è±Ô∏è –í—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏: ___ —Å–µ–∫—É–Ω–¥
- [ ] üí¨ –ü—Ä–∏—á–∏–Ω–∞ –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏: –î–∞/–ù–µ—Ç
- [ ] üóÑÔ∏è Status –≤ –ë–î: sent/failed

### –¢–µ—Å—Ç 2: –ü–µ—Ä–µ–Ω–æ—Å –∑–∞–ø–∏—Å–∏
- [ ] ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–æ
- [ ] ‚è±Ô∏è –í—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏: ___ —Å–µ–∫—É–Ω–¥
- [ ] üïê –°—Ç–∞—Ä–æ–µ –≤—Ä–µ–º—è –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏: –î–∞/–ù–µ—Ç
- [ ] üóÑÔ∏è Status –≤ –ë–î: sent/failed

### –¢–µ—Å—Ç 3: –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ü–µ–Ω
- [ ] ‚úÖ –¶–µ–Ω–∞ –≤–∏–¥–Ω–∞ –≤ –∫–∞—Ä—Ç–æ—á–∫–µ
- [ ] üí∞ –§–æ—Ä–º–∞—Ç: "üí∞ 1000 ‚ÇΩ"
- [ ] üì± –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –º–æ–±–∏–ª—å–Ω–æ–º: –î–∞/–ù–µ—Ç

---

**–°—Ç–∞—Ç—É—Å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:** ‚è≥ –û–∂–∏–¥–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è  
**–î–∞—Ç–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:** _____________  
**–¢–µ—Å—Ç–∏—Ä–æ–≤—â–∏–∫:** _____________
