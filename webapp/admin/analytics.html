<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Admin Analytics - BeautyAssist</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <link rel="stylesheet" href="analytics.css?v=20260205">
</head>
<body>
    <div class="analytics-container">
        <!-- Header -->
        <header class="header">
            <h1><i data-feather="bar-chart-2"></i> Аналитика</h1>
            <button id="refresh-btn" class="btn-refresh"><i data-feather="refresh-cw"></i> Обновить</button>
        </header>

        <!-- Navigation Tabs -->
        <nav class="tabs">
            <button class="tab active" data-tab="overview">Обзор</button>
            <button class="tab" data-tab="retention">Удержание</button>
            <button class="tab" data-tab="cohorts">Когорты</button>
            <button class="tab" data-tab="funnel">Воронка</button>
        </nav>

        <!-- Overview Tab -->
        <section id="overview" class="tab-content active">
            <div class="metrics-grid">
                <div class="metric-card">
                    <h3><i data-feather="users"></i> DAU</h3>
                    <p class="value" id="dau-value">-</p>
                    <span class="label">Дневная активность</span>
                </div>
                <div class="metric-card">
                    <h3><i data-feather="calendar"></i> WAU</h3>
                    <p class="value" id="wau-value">-</p>
                    <span class="label">Недельная активность</span>
                </div>
                <div class="metric-card">
                    <h3><i data-feather="calendar"></i> MAU</h3>
                    <p class="value" id="mau-value">-</p>
                    <span class="label">Месячная активность</span>
                </div>
                <div class="metric-card">
                    <h3><i data-feather="trending-up"></i> Рост</h3>
                    <p class="value" id="growth-value">-</p>
                    <span class="label">Прирост за месяц</span>
                </div>
                <div class="metric-card">
                    <h3><i data-feather="check-circle"></i> Активация</h3>
                    <p class="value" id="activation-value">-</p>
                    <span class="label">Завершили онбординг</span>
                </div>
                <div class="metric-card">
                    <h3><i data-feather="target"></i> Конверсия</h3>
                    <p class="value" id="paid-conversion-value">-</p>
                    <span class="label">Пробный → Платный</span>
                </div>
            </div>

            <div class="chart-container">
                <h2>Обзор удержания</h2>
                <canvas id="retention-overview-chart"></canvas>
            </div>
        </section>

        <!-- Retention Tab -->
        <section id="retention" class="tab-content">
            <div class="info-box">
                <h2>Удержание пользователей</h2>
                <p>Процент пользователей, вернувшихся через N дней после регистрации</p>
            </div>
            <div class="chart-container">
                <canvas id="retention-chart"></canvas>
            </div>
            <div class="retention-stats">
                <div class="stat-item">
                    <span class="stat-label">День 1:</span>
                    <span class="stat-value" id="day1-retention">-</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">День 7:</span>
                    <span class="stat-value" id="day7-retention">-</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">День 30:</span>
                    <span class="stat-value" id="day30-retention">-</span>
                </div>
            </div>
        </section>

        <!-- Cohorts Tab -->
        <section id="cohorts" class="tab-content">
            <div class="info-box">
                <h2>Анализ когорт</h2>
                <p>Удержание по неделям регистрации</p>
            </div>
            <div class="table-container">
                <table class="cohort-table" id="cohort-table">
                    <thead>
                        <tr>
                            <th>Неделя</th>
                            <th>Регистраций</th>
                            <th>День 0</th>
                            <th>День 7</th>
                            <th>День 14</th>
                            <th>День 30</th>
                        </tr>
                    </thead>
                    <tbody id="cohort-tbody">
                        <tr>
                            <td colspan="6" class="loading">Загрузка...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Funnel Tab -->
        <section id="funnel" class="tab-content">
            <div class="info-box">
                <h2>Воронка конверсии</h2>
                <p>Воронка активации пользователей</p>
            </div>
            <div class="funnel-container">
                <div class="funnel-stage">
                    <div class="stage-bar" id="registered-bar">
                        <span class="stage-label">Зарегистрировались</span>
                        <span class="stage-value" id="registered-value">-</span>
                    </div>
                </div>
                <div class="funnel-stage">
                    <div class="stage-bar" id="onboarded-bar">
                        <span class="stage-label">Завершили онбординг</span>
                        <span class="stage-value" id="onboarded-value">-</span>
                    </div>
                </div>
                <div class="funnel-stage">
                    <div class="stage-bar" id="first-service-bar">
                        <span class="stage-label">Создали услугу</span>
                        <span class="stage-value" id="first-service-value">-</span>
                    </div>
                </div>
                <div class="funnel-stage">
                    <div class="stage-bar" id="first-booking-bar">
                        <span class="stage-label">Получили запись</span>
                        <span class="stage-value" id="first-booking-value">-</span>
                    </div>
                </div>
                <div class="funnel-stage">
                    <div class="stage-bar" id="paid-bar">
                        <span class="stage-label">Оплатили подписку</span>
                        <span class="stage-value" id="paid-value">-</span>
                    </div>
                </div>
            </div>
            <div class="chart-container">
                <canvas id="funnel-chart"></canvas>
            </div>
        </section>

        <!-- Loading Overlay -->
        <div id="loading-overlay" class="loading-overlay">
            <div class="spinner"></div>
            <p>Загрузка данных...</p>
        </div>

        <!-- Error Message -->
        <div id="error-message" class="error-message"></div>
    </div>

    <script src="analytics.js?v=20260205"></script>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        if (typeof feather !== 'undefined') feather.replace({ 'stroke-width': 2.5 });
      });
    </script>
</body>
</html>
