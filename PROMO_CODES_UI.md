# üéüÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–∞–º–∏ —á–µ—Ä–µ–∑ –±–æ—Ç–∞

## –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

### –î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

–ê–¥–º–∏–Ω –º–æ–∂–µ—Ç **–ø–æ–ª–Ω–æ—Å—Ç—å—é —É–ø—Ä–∞–≤–ª—è—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥–∞–º–∏ —á–µ—Ä–µ–∑ –±–æ—Ç–∞** –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–∏—Å–∞—Ç—å SQL-–∑–∞–ø—Ä–æ—Å—ã.

#### 1. –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤ (FSM –≤–∏–∑–∞—Ä–¥)

**–ö–æ–º–∞–Ω–¥–∞**: `/admin` ‚Üí "üéüÔ∏è –ü—Ä–æ–º–æ–∫–æ–¥—ã" ‚Üí "‚ûï –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥"

**–ü—Ä–æ—Ü–µ—Å—Å —Å–æ–∑–¥–∞–Ω–∏—è (5 —à–∞–≥–æ–≤)**:

##### –®–∞–≥ 1: –ö–æ–¥ –ø—Ä–æ–º–æ–∫–æ–¥–∞
- –í–≤–æ–¥–∏—Ç –∫–æ–¥ (4-20 —Å–∏–º–≤–æ–ª–æ–≤)
- –¢–æ–ª—å–∫–æ –ª–∞—Ç–∏–Ω—Å–∫–∏–µ –±—É–∫–≤—ã –∏ —Ü–∏—Ñ—Ä—ã
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ –≤–µ—Ä—Ö–Ω–∏–π —Ä–µ–≥–∏—Å—Ç—Ä

##### –®–∞–≥ 2: –¢–∏–ø –ø—Ä–æ–º–æ–∫–æ–¥–∞
–í—ã–±–æ—Ä –∏–∑ —Ç—Ä–µ—Ö —Ç–∏–ø–æ–≤:
- **–ü—Ä–æ—Ü–µ–Ω—Ç–Ω–∞—è —Å–∫–∏–¥–∫–∞** (discount_percent)
- **–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—É–º–º–∞** (discount_amount)
- **–ü—Ä–æ–¥–ª–µ–Ω–∏–µ —Ç—Ä–∏–∞–ª–∞** (trial_extension_days)

##### –®–∞–≥ 3: –†–∞–∑–º–µ—Ä —Å–∫–∏–¥–∫–∏
–í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞:
- **–ü—Ä–æ—Ü–µ–Ω—Ç**: –æ—Ç 1% –¥–æ 100%
- **–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—É–º–º–∞**: –ª—é–±–∞—è –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–∞—è —Å—É–º–º–∞ –≤ ‚ÇΩ
- **–î–Ω–∏ —Ç—Ä–∏–∞–ª–∞**: –æ—Ç 1 –¥–æ 365 –¥–Ω–µ–π

##### –®–∞–≥ 4: –õ–∏–º–∏—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π
–î–≤–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞:
- **–ß–∏—Å–ª–æ**: –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å > 0)
- **–ö–Ω–æ–ø–∫–∞ "‚ôæÔ∏è –ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ"**: `max_uses = NULL`

##### –®–∞–≥ 5: –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è
–î–≤–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞:
- **–ß–∏—Å–ª–æ –¥–Ω–µ–π**: –ø—Ä–æ–º–æ–∫–æ–¥ –±—É–¥–µ—Ç –¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —É–∫–∞–∑–∞–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π
- **–ö–Ω–æ–ø–∫–∞ "‚ôæÔ∏è –ë–µ—Å—Å—Ä–æ—á–Ω–æ"**: `valid_until = NULL`

##### –®–∞–≥ 6: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ–ª–Ω–∞—è —Å–≤–æ–¥–∫–∞:
```
üìã –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–º–æ–∫–æ–¥–∞:

–ö–æ–¥: SUMMER2025
–¢–∏–ø: –ü—Ä–æ—Ü–µ–Ω—Ç–Ω–∞—è —Å–∫–∏–¥–∫–∞
–°–∫–∏–¥–∫–∞: 30%
–õ–∏–º–∏—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π: 100 —Ä–∞–∑
–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è: –¥–æ 15.03.2025 15:30 UTC

–í—Å—ë –≤–µ—Ä–Ω–æ?
```

–ö–Ω–æ–ø–∫–∏: "‚úÖ –î–∞, —Å–æ–∑–¥–∞—Ç—å" | "‚ùå –û—Ç–º–µ–Ω–∞"

#### 2. –ü—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤

**–ö–æ–º–∞–Ω–¥–∞**: `/admin` ‚Üí "üéüÔ∏è –ü—Ä–æ–º–æ–∫–æ–¥—ã" ‚Üí "üìã –°–ø–∏—Å–æ–∫ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤"

–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ –ø—Ä–æ–º–æ–∫–æ–¥—ã —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π:
- –ö–æ–¥ (—Å —ç–º–æ–¥–∑–∏ —Å—Ç–∞—Ç—É—Å–∞: ‚úÖ –∞–∫—Ç–∏–≤–Ω—ã–π / ‚è∏Ô∏è –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–π)
- –¢–∏–ø —Å–∫–∏–¥–∫–∏
- –†–∞–∑–º–µ—Ä —Å–∫–∏–¥–∫–∏
- –õ–∏–º–∏—Ç—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

–§–æ—Ä–º–∞—Ç:
```
‚úÖ NEWYEAR2025
–¢–∏–ø: –ü—Ä–æ—Ü–µ–Ω—Ç–Ω–∞—è —Å–∫–∏–¥–∫–∞ (30%)
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: 45 / 100
–î–µ–π—Å—Ç–≤—É–µ—Ç –¥–æ: 31.01.2025 23:59 UTC
```

#### 3. –î–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤

**–ö–æ–º–∞–Ω–¥–∞**: Callback-–∫–Ω–æ–ø–∫–∞ "üö´ –î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å [–ö–û–î]" –≤ —Å–ø–∏—Å–∫–µ –∏–ª–∏ –¥–µ—Ç–∞–ª—è—Ö –ø—Ä–æ–º–æ–∫–æ–¥–∞

–ò–∑–º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å –ø—Ä–æ–º–æ–∫–æ–¥–∞ –Ω–∞ `inactive`, –±–ª–æ–∫–∏—Ä—É—è –µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ.

#### 4. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤

**–ö–æ–º–∞–Ω–¥–∞**: `/admin` ‚Üí "üéüÔ∏è –ü—Ä–æ–º–æ–∫–æ–¥—ã" ‚Üí "üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞"

–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ–±—â—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É:
- –í—Å–µ–≥–æ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤ (–∞–∫—Ç–∏–≤–Ω—ã—Ö / –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö)
- –í—Å–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π
- –¢–û–ü-3 –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –ø—Ä–æ–º–æ–∫–æ–¥–∞
- –ö–æ–Ω–≤–µ—Ä—Å–∏—è (% –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö)

#### 5. –û—Ç–º–µ–Ω–∞ —Å–æ–∑–¥–∞–Ω–∏—è

–í –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω–∏—è –º–æ–∂–Ω–æ:
- –ù–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É **"‚ùå –û—Ç–º–µ–Ω–∞"**
- –í–≤–µ—Å—Ç–∏ –∫–æ–º–∞–Ω–¥—É **/cancel**

FSM –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—â–∞–µ—Ç—Å—è, –¥–∞–Ω–Ω—ã–µ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è.

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### FSM States

```python
class PromoCodeStates(StatesGroup):
    waiting_for_code = State()           # –û–∂–∏–¥–∞–Ω–∏–µ –∫–æ–¥–∞
    waiting_for_type = State()           # –û–∂–∏–¥–∞–Ω–∏–µ —Ç–∏–ø–∞
    waiting_for_discount = State()       # –û–∂–∏–¥–∞–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —Å–∫–∏–¥–∫–∏
    waiting_for_max_uses = State()       # –û–∂–∏–¥–∞–Ω–∏–µ –ª–∏–º–∏—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π
    waiting_for_valid_days = State()     # –û–∂–∏–¥–∞–Ω–∏–µ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è
    confirm = State()                    # –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
```

### –í–∞–ª–∏–¥–∞—Ü–∏—è

#### –ö–æ–¥ –ø—Ä–æ–º–æ–∫–æ–¥–∞
```python
def validate_promo_code(code: str) -> tuple[bool, str]:
    if not re.match(r'^[A-Za-z0-9]+$', code):
        return False, "–ö–æ–¥ –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –ª–∞—Ç–∏–Ω—Å–∫–∏–µ –±—É–∫–≤—ã –∏ —Ü–∏—Ñ—Ä—ã"
    if not (4 <= len(code) <= 20):
        return False, "–î–ª–∏–Ω–∞ –∫–æ–¥–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ç 4 –¥–æ 20 —Å–∏–º–≤–æ–ª–æ–≤"
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ –ë–î
    return True, ""
```

#### –†–∞–∑–º–µ—Ä —Å–∫–∏–¥–∫–∏
```python
# –ü—Ä–æ—Ü–µ–Ω—Ç: 1-100
if promo_type == 'percent':
    if not (1 <= value <= 100):
        return False, "–ü—Ä–æ—Ü–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 1 –¥–æ 100"

# –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—É–º–º–∞: > 0
elif promo_type == 'fixed':
    if value <= 0:
        return False, "–°—É–º–º–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –±–æ–ª—å—à–µ 0"

# –î–Ω–∏ —Ç—Ä–∏–∞–ª–∞: 1-365
elif promo_type == 'trial_extension':
    if not (1 <= value <= 365):
        return False, "–î–Ω–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ—Ç 1 –¥–æ 365"
```

#### –õ–∏–º–∏—Ç—ã
```python
# Max uses: > 0 –∏–ª–∏ NULL (–Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ)
if max_uses is not None and max_uses <= 0:
    return False, "–õ–∏–º–∏—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –±–æ–ª—å—à–µ 0"

# Valid days: > 0 –∏–ª–∏ NULL (–±–µ—Å—Å—Ä–æ—á–Ω–æ)
if valid_days is not None:
    if valid_days <= 0:
        return False, "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –±–æ–ª—å—à–µ 0"
    valid_until = datetime.now(timezone.utc) + timedelta(days=valid_days)
```

### –°–æ–∑–¥–∞–Ω–∏–µ –≤ –ë–î

```python
async with get_admin_session() as session:
    promo_repo = PromoCodeRepository(session)
    
    promo_data = {
        'code': code,
        'type': promo_type,
        'discount_percent': discount_percent,  # –¥–ª—è percent
        'discount_amount': discount_amount,    # –¥–ª—è fixed
        'trial_extension_days': trial_days,    # –¥–ª—è trial_extension
        'max_uses': max_uses,                  # –º–æ–∂–µ—Ç –±—ã—Ç—å None
        'valid_until': valid_until,            # –º–æ–∂–µ—Ç –±—ã—Ç—å None
        'status': 'active',
        'created_at': datetime.now(timezone.utc)
    }
    
    promo_code = await promo_repo.create_promo_code(**promo_data)
    await session.commit()
```

---

## –£–ª—É—á—à–µ–Ω–∏—è UX

### –î–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞
–ê–¥–º–∏–Ω –≤–∏–¥–µ–ª —Ç–æ–ª—å–∫–æ SQL-–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é:
```sql
INSERT INTO promo_codes (code, type, discount_percent, ...)
VALUES ('NEWCODE', 'percent', 20, ...);
```

### –ü–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞
- ‚úÖ –ü–æ—à–∞–≥–æ–≤—ã–π –≤–∏–∑–∞—Ä–¥ (5 —à–∞–≥–æ–≤)
- ‚úÖ Inline-–∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–æ–≤
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ –∫–æ–¥–∞ —á–µ—Ä–µ–∑ –ë–î
- ‚úÖ –≠–∫—Ä–∞–Ω –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Å –ø–æ–ª–Ω–æ–π —Å–≤–æ–¥–∫–æ–π
- ‚úÖ –ö–Ω–æ–ø–∫–∏ "–ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ" –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
- ‚úÖ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–º–µ–Ω—ã –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç
- ‚úÖ –î–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤ –æ–¥–Ω–æ–π –∫–Ω–æ–ø–∫–æ–π

---

## –¢–µ—Å—Ç—ã

–°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `tests/test_admin_promo_creation.py` —Å 20+ —Ç–µ—Å—Ç–∞–º–∏:

### Unit-—Ç–µ—Å—Ç—ã
- `test_callback_promo_create_starts_fsm` - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø—É—Å–∫–∞ FSM
- `test_process_promo_code_valid_code` - –í–∞–ª–∏–¥–Ω—ã–π –∫–æ–¥
- `test_process_promo_code_invalid_characters` - –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã
- `test_process_promo_code_too_short` - –°–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π –∫–æ–¥
- `test_process_promo_code_already_exists` - –î—É–±–ª–∏–∫–∞—Ç –∫–æ–¥–∞
- `test_process_promo_type_percent` - –í—ã–±–æ—Ä —Ç–∏–ø–∞ "–ø—Ä–æ—Ü–µ–Ω—Ç"
- `test_process_promo_discount_valid_percent` - –í–∞–ª–∏–¥–Ω—ã–π –ø—Ä–æ—Ü–µ–Ω—Ç
- `test_process_promo_discount_invalid_percent` - –ü—Ä–æ—Ü–µ–Ω—Ç > 100
- `test_process_promo_discount_fixed_amount` - –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—É–º–º–∞
- `test_process_promo_discount_trial_extension` - –ü—Ä–æ–¥–ª–µ–Ω–∏–µ —Ç—Ä–∏–∞–ª–∞
- `test_process_promo_maxuses_valid` - –í–∞–ª–∏–¥–Ω—ã–π –ª–∏–º–∏—Ç
- `test_process_promo_validdays_valid` - –í–∞–ª–∏–¥–Ω—ã–π —Å—Ä–æ–∫
- `test_process_promo_confirm_creates_promo` - –°–æ–∑–¥–∞–Ω–∏–µ –≤ –ë–î
- `test_callback_promo_cancel` - –û—Ç–º–µ–Ω–∞ —Å–æ–∑–¥–∞–Ω–∏—è

### Integration-—Ç–µ—Å—Ç
- `test_full_promo_creation_flow` - –ü–æ–ª–Ω—ã–π —Ñ–ª–æ—É –æ—Ç –ê –¥–æ –Ø

–ó–∞–ø—É—Å–∫:
```bash
pytest tests/test_admin_promo_creation.py -v
```

---

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –ü—Ä–æ—Ü–µ–Ω—Ç–Ω–∞—è —Å–∫–∏–¥–∫–∞ 30%
```
1. –ö–æ–¥: SUMMER30
2. –¢–∏–ø: –ü—Ä–æ—Ü–µ–Ω—Ç–Ω–∞—è —Å–∫–∏–¥–∫–∞
3. –°–∫–∏–¥–∫–∞: 30%
4. –õ–∏–º–∏—Ç: 100
5. –°—Ä–æ–∫: 60 –¥–Ω–µ–π
```

### –ü—Ä–∏–º–µ—Ä 2: –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–∫–∏–¥–∫–∞ 500‚ÇΩ
```
1. –ö–æ–¥: WELCOME500
2. –¢–∏–ø: –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—É–º–º–∞
3. –°—É–º–º–∞: 500‚ÇΩ
4. –õ–∏–º–∏—Ç: –ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ
5. –°—Ä–æ–∫: –ë–µ—Å—Å—Ä–æ—á–Ω–æ
```

### –ü—Ä–∏–º–µ—Ä 3: –ü—Ä–æ–¥–ª–µ–Ω–∏–µ —Ç—Ä–∏–∞–ª–∞ –Ω–∞ 7 –¥–Ω–µ–π
```
1. –ö–æ–¥: TRIAL7
2. –¢–∏–ø: –ü—Ä–æ–¥–ª–µ–Ω–∏–µ —Ç—Ä–∏–∞–ª–∞
3. –î–Ω–∏: 7
4. –õ–∏–º–∏—Ç: 50
5. –°—Ä–æ–∫: 30 –¥–Ω–µ–π
```

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
bot/
  handlers/
    admin.py                    # 500+ —Å—Ç—Ä–æ–∫ –Ω–æ–≤–æ–≥–æ FSM –∫–æ–¥–∞
      - PromoCodeStates         # FSM –∫–ª–∞—Å—Å —Å 6 —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏
      - callback_promo_create   # –°—Ç–∞—Ä—Ç FSM
      - process_promo_code      # –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–¥–∞
      - process_promo_type      # –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–∏–ø–∞
      - process_promo_discount  # –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–∫–∏–¥–∫–∏
      - process_promo_maxuses   # –û–±—Ä–∞–±–æ—Ç–∫–∞ –ª–∏–º–∏—Ç–∞
      - process_promo_validdays # –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ä–æ–∫–∞
      - show_confirmation       # –≠–∫—Ä–∞–Ω –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
      - process_promo_confirm   # –°–æ–∑–¥–∞–Ω–∏–µ –≤ –ë–î
      - callback_promo_deactivate # –î–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è
      - callback_promo_cancel   # –û—Ç–º–µ–Ω–∞
      - cancel_promo_creation   # /cancel –∫–æ–º–∞–Ω–¥–∞

  keyboards/
    admin.py
      - get_promo_codes_menu()           # –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤
      - get_promo_code_detail_keyboard() # –î–µ—Ç–∞–ª–∏ –ø—Ä–æ–º–æ–∫–æ–¥–∞

database/
  models/
    promo_code.py              # PromoCode –º–æ–¥–µ–ª—å
  repositories/
    promo_code.py              # PromoCodeRepository

tests/
  test_admin_promo_creation.py # 20+ —Ç–µ—Å—Ç–æ–≤
```

---

## –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤
pytest tests/test_admin_promo_creation.py -v

# –° –ø–æ–∫—Ä—ã—Ç–∏–µ–º
pytest tests/test_admin_promo_creation.py --cov=bot.handlers.admin

# –ü–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä —Ç–µ—Å—Ç–æ–≤
pytest tests/ -v
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤
```bash
mypy bot/handlers/admin.py
```

### –õ–∏–Ω—Ç–∏–Ω–≥
```bash
ruff check bot/handlers/admin.py
```

---

## –°—Ç–∞—Ç—É—Å: ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ production

–í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã, –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.
