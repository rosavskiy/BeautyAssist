<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–§–∏–Ω–∞–Ω—Å—ã</title>
  <meta name="theme-color" content="#B8A7D6" />
  <meta name="color-scheme" content="light" />
  <link rel="stylesheet" href="/webapp-master/master.css" />
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <style>
    /* Telegram WebApp theme colors for native date picker */
    :root {
      color-scheme: light;
    }
  </style>
</head>
<body>
  <div id="app" class="fin-app">
    <header class="fin-header">
      <div style="display: flex; align-items: center; gap: 12px;">
        <button id="back-to-master" class="icon-btn" style="font-size: 24px;" title="–ù–∞–∑–∞–¥">‚Äπ</button>
        <h1 class="fin-title">üí∞ –§–∏–Ω–∞–Ω—Å—ã</h1>
      </div>
      <div class="fin-periods">
        <button class="period-btn active" data-period="week">–ù–µ–¥–µ–ª—è</button>
        <button class="period-btn" data-period="month">–ú–µ—Å—è—Ü</button>
        <button class="period-btn" data-period="year">–ì–æ–¥</button>
        <button class="period-btn" data-period="custom">–ü–µ—Ä–∏–æ–¥</button>
      </div>
    </header>

    <!-- Custom period selector (hidden by default) -->
    <section id="custom-period" class="fin-custom-period custom-period hidden">
      <input type="text" id="start-date" placeholder="–¥–¥.–º–º.–≥–≥–≥–≥" readonly style="flex: 1; min-width: 100px;" />
      <span>‚Äî</span>
      <input type="text" id="end-date" placeholder="–¥–¥.–º–º.–≥–≥–≥–≥" readonly style="flex: 1; min-width: 100px;" />
      <button id="apply-period" class="btn-primary">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
    </section>

    <!-- Calendar for period selection -->
    <section id="period-calendar-section" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="period-calendar-title">–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É</h2>
          <button id="period-calendar-close" class="icon-btn">√ó</button>
        </div>
        <div class="calendar">
          <div class="calendar-nav">
            <button id="period-cal-prev" class="nav-btn">‚Äπ</button>
            <div id="period-cal-title" class="cal-title"></div>
            <button id="period-cal-next" class="nav-btn">‚Ä∫</button>
          </div>
          <div class="calendar-weekdays">
            <div class="weekday">–ü–Ω</div>
            <div class="weekday">–í—Ç</div>
            <div class="weekday">–°—Ä</div>
            <div class="weekday">–ß—Ç</div>
            <div class="weekday">–ü—Ç</div>
            <div class="weekday">–°–±</div>
            <div class="weekday">–í—Å</div>
          </div>
          <div class="calendar-grid" id="period-calendar-grid"></div>
        </div>
      </div>
    </section>

    <!-- Financial Summary Cards -->
    <section class="fin-summary">
      <div class="fin-card fin-revenue">
        <div class="fin-icon">üìà</div>
        <div class="fin-content">
          <div class="fin-label">–í—ã—Ä—É—á–∫–∞</div>
          <div class="fin-value" id="total-revenue">0 ‚ÇΩ</div>
          <div class="fin-sub" id="appointments-count">0 –∑–∞–ø–∏—Å–µ–π</div>
        </div>
      </div>
      <div class="fin-card fin-expenses">
        <div class="fin-icon">üìâ</div>
        <div class="fin-content">
          <div class="fin-label">–†–∞—Å—Ö–æ–¥—ã</div>
          <div class="fin-value" id="total-expenses">0 ‚ÇΩ</div>
          <div class="fin-sub" id="expenses-count">0 –ø–æ–∑–∏—Ü–∏–π</div>
        </div>
      </div>
      <div class="fin-card fin-profit">
        <div class="fin-icon">üíé</div>
        <div class="fin-content">
          <div class="fin-label">–ü—Ä–∏–±—ã–ª—å</div>
          <div class="fin-value" id="total-profit">0 ‚ÇΩ</div>
          <div class="fin-sub" id="profit-margin">0%</div>
        </div>
      </div>
    </section>

    <!-- Charts -->
    <section class="fin-charts charts">
      <div class="fin-chart chart-container">
        <h3>–í—ã—Ä—É—á–∫–∞ –ø–æ —É—Å–ª—É–≥–∞–º</h3>
        <canvas id="revenue-chart"></canvas>
      </div>
      <div class="fin-chart chart-container">
        <h3>–†–∞—Å—Ö–æ–¥—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</h3>
        <canvas id="expenses-chart"></canvas>
      </div>
    </section>

    <!-- Expenses Management -->
    <section class="fin-expenses expenses-section">
      <div class="fin-expenses-header section-header">
        <h2>–†–∞—Å—Ö–æ–¥—ã</h2>
        <button id="add-expense-btn" class="btn-add">+ –î–æ–±–∞–≤–∏—Ç—å</button>
      </div>
      <div id="expenses-list" class="fin-expenses-list expenses-list"></div>
    </section>

    <!-- Add/Edit Expense Modal -->
    <div id="expense-modal" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="modal-title">–ù–æ–≤—ã–π —Ä–∞—Å—Ö–æ–¥</h3>
          <button id="modal-close" class="icon-btn">√ó</button>
        </div>
        <div class="modal-body">
          <input type="hidden" id="expense-id" />
          
          <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
          <select id="expense-category">
            <option value="materials">–ú–∞—Ç–µ—Ä–∏–∞–ª—ã</option>
            <option value="rent">–ê—Ä–µ–Ω–¥–∞</option>
            <option value="advertising">–†–µ–∫–ª–∞–º–∞</option>
            <option value="transport">–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç</option>
            <option value="education">–û–±—É—á–µ–Ω–∏–µ</option>
            <option value="equipment">–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ</option>
            <option value="other">–î—Ä—É–≥–æ–µ</option>
          </select>
          
          <label>–°—É–º–º–∞ (‚ÇΩ)</label>
          <input type="number" id="expense-amount" placeholder="1000" min="0" />
          
          <label>–î–∞—Ç–∞</label>
          <input type="text" id="expense-date" placeholder="–¥–¥.–º–º.–≥–≥–≥–≥" readonly />
          
          <label>–û–ø–∏—Å–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
          <textarea id="expense-description" rows="3" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ —Ä–∞—Å—Ö–æ–¥—É"></textarea>
          
          <div class="modal-actions">
            <button id="save-expense" class="btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            <button id="cancel-expense" class="btn-secondary">–û—Ç–º–µ–Ω–∞</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Calendar for expense date -->
    <section id="expense-calendar-section" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h2>–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É</h2>
          <button id="expense-calendar-close" class="icon-btn">√ó</button>
        </div>
        <div class="calendar">
          <div class="calendar-nav">
            <button id="expense-cal-prev" class="nav-btn">‚Äπ</button>
            <div id="expense-cal-title" class="cal-title"></div>
            <button id="expense-cal-next" class="nav-btn">‚Ä∫</button>
          </div>
          <div class="calendar-weekdays">
            <div class="weekday">–ü–Ω</div>
            <div class="weekday">–í—Ç</div>
            <div class="weekday">–°—Ä</div>
            <div class="weekday">–ß—Ç</div>
            <div class="weekday">–ü—Ç</div>
            <div class="weekday">–°–±</div>
            <div class="weekday">–í—Å</div>
          </div>
          <div class="calendar-grid" id="expense-calendar-grid"></div>
        </div>
      </div>
    </section>
  </div>

  <script src="/webapp-master/finances.js"></script>
</body>
</html>
